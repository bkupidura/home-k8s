---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: mosquitto
  namespace: kube-system
spec:
  repo: https://k8s-at-home.com/charts/
  chart: mosquitto
  version: {{ manifest.versions.mosquitto.chart }}
  targetNamespace: smart-home
  valuesContent: |-
    resources:
      requests:
        memory: 32Mi
        cpu: 50m
      limits:
        memory: 32Mi
        cpu: 50m
    image:
      repository: {{ manifest.versions.mosquitto.image.repository }}
      tag: {{ manifest.versions.mosquitto.image.tag }}
    env:
      TZ: {{ global.timezone }}
    persistence:
      configinc:
        enabled: true
        type: custom
        volumeSpec:
          secret:
            secretName: mosquitto
      data:
        enabled: true
        storageClass: {{ global.k8s.storage.class.default.name }}
        size: 1Gi
        type: pvc
        accessMode: {{ global.k8s.storage.class.default.mode }}
    service:
      main:
        type: LoadBalancer
        loadBalancerIP: "{{ global.vips[3].ip }}"
        externalTrafficPolicy: Local
        ports:
          http:
            enabled: false
          mqtt:
            enabled: true
    auth:
      enabled: true
