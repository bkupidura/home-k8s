---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: kubernetes-descheduler
  namespace: kube-system
spec:
  repo: https://kubernetes-sigs.github.io/descheduler/
  chart: descheduler
  version: {{ versions.descheduler.chart }}
  targetNamespace: kube-system
  valuesContent: |-
    kind: Deployment
    deschedulingInterval: 10m
    resources:
      requests:
        cpu: 20m
        memory: 32Mi
      limits:
        cpu: 50m
        memory: 64Mi
    deschedulerPolicy:
      strategies:
        RemoveDuplicates:
          enabled: false
        RemovePodsViolatingNodeTaints:
          enabled: false
        RemovePodsViolatingNodeAffinity:
          enabled: false
        RemovePodsViolatingInterPodAntiAffinity:
          enabled: true
          params:
            nodeFit: true
        LowNodeUtilization:
          enabled: true
          params:
            nodeFit: true
            nodeResourceUtilizationThresholds:
              thresholds:
                cpu: 35
                memory: 20
                pods: 15
              targetThresholds:
                cpu: 50
                memory: 60
                pods: 25
        PodLifeTime:
          enabled: true
          params:
            podLifeTime:
              maxPodLifeTimeSeconds: 259200
            podStatusPhases:
              - "Running"
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: unifi
